---
title: קונבולוציה
author: אופיר דוד
category: התמרות פורייה
layout: post
dir: rtl
cssclasses:
  - hebrew
---
# מה זו קונבולוציה

ראינו כבר הרבה תכונות מעניינות של התמרת פורייה, ובפרט ראינו שהיא לוקחת פעולות שאנו רגילים לעבור איתם כל חיבור, כפל, סיבוב, הצמדה וכו' פחות או יותר לעצמן. פעולה נוספת מאוד חשובה היא כפל של פונקציות, ונרצה להראות איך לבטא את ההתמרה $\widehat{f\cdot g}$ באמצעות ההתמרות $\hat{f},\hat{g}$. פה מגיעה פעולת הקונבולוציה, אבל לפני שנגדיר אותה ונראה אותה מופיעה בהתמרות האלו, בואו נראה שבעצם אנחנו מכירים אותה כבר.
אחת ממשפחות הפונקציות הכי פשוטה שאנחנו מכירים היא משפחת הפולינומים, כלומר פונקציות מהצורה:
$$.f(x)=a_0+a_1 x + a_2 x^2 +\cdots +a_d x^d = \sum_0^d a_k x^k$$
גם פה במובן מסויים יש לנו "התמרה". אם מתחילים עם הפונקציה $f$ אז המקביל למקדמי פורייה אלו פשוט המקדמים $a_k$ ו"ההתמרה ההפוכה" זו הקומבינציה שלהם שבאגף ימין בביטוי למעלה.
$$\align{f&\overset{'\cf'}{\longrightarrow}(a_0,a_1,...,a_d)\\.
\sum_0^da_kx^k & \overset{'\cf^{-1}\;'}{\longleftarrow}(a_0,a_1,...,a_d)}$$

אם נתון לנו פולינום נוסף
$$,g(x)=b_0+b_1 x + b_2 x^2 +\cdots +b_d x^d = \sum_0^d b_k x^k$$
אז הפונקציה $f(x)g(x)$ היא גם פולינום, ולכן נוכל לשאול איך מבטאים את המקדמים שלה ע"י המקדמים $a_k,b_k$ של $f(x),g(x)$. במקרה הזה נקבל ש :
$$\align{f(x)g(x) & = \left(\sum_{i=0}^d a_i x^i\right)\left(\sum_{j=0}^d b_j x^j\right) = \sum_{i=0}^d\sum_{j=0}^d a_i b_j \cdot x^{i+j} = \sum_{k=0}^{2d} \left(\sum_{i+j=k} a_i b_j\right) \cdot x^{k} = \sum_{k=0}^{2d} \left(\sum_{i} a_i b_{k-i}\right) \cdot x^{k} \\ &= a_0b_0+(a_0b_1+a_1b_0)x+(a_0b_2+a_1b_1+a_2b_0)x^2+\cdots +(a_{d-1}b_d+a_db_{d-1})x^{2d-1}+a_db_dx^{2d}}$$

כלומר, המקדם של $x^k$ הוא סכום של מכפלות של המקדמים של $f,g$ כך שהאינדקסים שלהם נסכמים ל $k$. הסיבה למבנה המעניין הזה הוא בעצם חוקי החזקות שהמונומים מקיימים, כלומר $x^i x^j = x^{i+j}$.  

כדי לקבל קצת יותר אינטואיציה לכפל הזה, ולקונבולוציה שעוד מעט נגדיר, נניח שהפולינומים הם מדרגה $d=2$ ורוצים למצוא את המקדם החופשי. נכתוב מקדמי הפולינומים בטבלה, כאשר המקדמים של $f$ גדלים באינדקס כאשר זזים ימינה, והמקדמים של $g$ קטנים באינדקס, ואם נשים אותה כך שהמקדם החופשי של $f$ יהיה מעל המקדם החופשי של $g$ אז רק צריך לכפול את התא בשורה הראשונה (של $f$) בתא מתחתיו (של $g$) לכתוב בתא בשורה השלישית ואז לסכום את השורה השלישית:

| $a_2x^2$ | $a_1x^1$ |  $a_0 x^0$  | 0         | 0        |
| :------: | :------: | :---------: | :-------: | :------: |
| 0        | 0        |  $b_0 x^0$  | $b_1 x^1$ | $b_2x^2$ |
| 0        | 0        | $a_0b_0x^0$ | 0         | 0        |

אם נרצה את המקדם של $x$, אז זה יהיה אותו הדבר, רק צריך להזיז את כל המקדמים בשורה הראשונה תא אחד שמאלה:

| $a_2x^2$ |  $a_1x^1$   |  $a_0 x^0$  |    0     |
| :------: | :---------: | :---------: | :------: |
|    0     |  $b_0 x^0$  |  $b_1 x^1$  | $b_2x^2$ |
|    0     | $a_1b_0x^1$ | $a_0b_1x^1$ |    0     |

ואם נרצה את המקדם של $x^2$ אז נזיז אותם עוד תא שמאלה וכך הלאה:

|  0  |  $a_2x^2$   |  $a_1x^1$   |  $a_0 x^0$  | 0   |
| :-: | :---------: | :---------: | :---------: | :-: |
|  0  |  $b_0 x^0$  |  $b_1 x^1$  |  $b_2x^2$   | 0   |
|  0  | $a_2b_0x^2$ | $a_1b_1x^2$ | $a_0b_2x^2$ | 0   |

מאחר וחוקי החזקות האלו מתקיים גם עבור האקספוננטים שלנו, נקבל משהו דומה, פרט לכך שבמקום מקדמים דיסקרטים, יש לנו מקדמים רציפים.

# קונבולוציה של פונקציות

> [!הגדרה] הגדרה: קונבולוציה:
> עבור שתי פונקציות $f,g:\RR \to \CC$ נגדיר את הקונבולוציה שלהן $(f*g)$ להיות האינטגרל (כאשר הוא מוגדר):
> $$.(f*g)(x)=\int_{-\infty}^\infty f(x-y)g(y) \dy$$

נשים לב תחילה ש"סכום האינדקסים" בתוך הקונבולוציה הוא תמיד $(x-y)+y=x$ בדיוק כמו שבכפל פולינומים הסכום תמיד היה $(k-i)+i=k$.
ההגדרה של הקונבולוציה דומה להגדרה של מכפלה פנימית, רק במקום לכפול באינטגרנד ב $f(y)$ אנחנו עושים שיקוף $y\mapsto-y$ ואז הזזה ב $x$. בדומה למכפלה הפנימית, יש שני מקרים בהם הקונבולוציה מוגדרת לכל $x$ עם הוכחות דומה לאלו מהמכפלה הפנימית:
- אם אחת מהפונקציות היא חסומה והשנייה אינטגרבילית בהחלט (כלומר ב $E^\infty(\RR)$ ו $E^1(\RR)$ בהתאם).
- אם שתי הפונקציות נמצאות ב $E^2(\RR)$.
מקרה נוסף מעניין שדורש קצת יותר מאמץ הוא כאשר שתי הפונקציות הן ב $E^1(\RR)$ אך לפני שנוכיח את זה, בואו נראה דוגמא בסיסית בשביל האינטואיציה.

> [!דוגמא] דוגמא: קונבולוציה של פונקציות מציינות
> נסתכל על שתי פונקציות מציינות של קטעים, הראשונה של $[-1,1]$ והשנייה של $[-h,h]$:
> $$\align{f(x)=\chi_{[-1,1]}(x)=\cases{1&|x|\leq 1 \\ 0 & |x|>1} \\ .g(x)=\chi_{[-h,h]}(x)=\cases{1&|x|\leq h \\ 0 & |x|>h}}$$
> בחישוב של הקונבולוציה, אנחנו מכפילים בין שתי הפונקציות ומבצעים אינטגרציה. הפונקציה $g(y)$ שמופיעה באינטגרל "לא זזה" כאשר $x$ משתנה, בעוד שהפונקציה $f(x-y)$ כן. מאחר ושתיהן מתארות קטע, המכפלה שלהן מתארת את החיתוך, ואז האינטגרל מתאר את אורך הקטע.
> בתכנה למטה מ[דסמוס](https://www.desmos.com/calculator/er3rndwu4n) אפשר לראות באדום את הפונקציה $g$ בירוק את $f$ והגרף השחור הוא של הקונבולוציה.
> <iframe src="https://www.desmos.com/calculator/96tqlwyply?embed" width="800" height="400" style="border: 1px solid #ccc" frameborder=0></iframe>
> 
> נסו לשחק עם הפרמטרים $x,h$ ולראות שאתם מבינים למה גרף הקונבולוציה נראה כמו שהוא נראה.

> [!תרגיל] תרגיל:
> חשבו את הקונבולוציה של שתי פונקציות מציינות $f(x)=\chi_{[-a,a]}$ ו $g(x)=\chi_{[-b,b]}$ כפונקציה של הפרמטרים $a,b\geq 0$. 

# תכונות של קונבולוציה

לפני שנתחיל עם תכונות, נזכיר את משפט פוביני טונלי שעוזר בחישוב אינטגרלים:

> [!משפט] משפט פוביני טונלי.
> תהא $H(x,y):\RR^2\to \CC$ פונקציה מדידה, אז 
> $$\int_{-\infty}^\infty\left(\int_{-\infty}^\infty |H(x,y)| \dx\right)\dy = \int_{-\infty}^\infty\left(\int_{-\infty}^\infty |H(x,y)| \dy\right)\dx = \int_{\RR^2} |H(x,y)| \operatorname{d(x,y)}$$
> בנוסף, אם האינטגרלים האלו סופיים אז 
> 
> $$\int_{-\infty}^\infty\left(\int_{-\infty}^\infty H(x,y) \dx\right)\dy = \int_{-\infty}^\infty\left(\int_{-\infty}^\infty H(x,y) \dy\right)\dx = \int_{\RR^2} H(x,y) \operatorname{d(x,y)}$$

באמצעות משפט פוביני טונלי, אנחנו יכולים להראות סגירות לכפל קונבולוציה.

> [!משפט] משפט: קונבולוציה של פונקציות ב $E^1(\RR)$.
> יהיו $f,g\in E^1(\RR)$. אז הקונבולוציה $(f*g)(x)$ מוגדרת כמעט לכל $x$ והיא אינטגרבילית בהחלט.

> [!הוכחה] הוכחה:
> אם נניח שהקונבולוציה מוגדרת לכל $x$, ונרצה להראות שהיא אינטגרבילית בהחלט, אז בגלל ש
> $$\int_{-\infty}^\infty \abs{(f*g)(x)}\dx = \int_{-\infty}^\infty \abs{\int_{-\infty}^\infty f(x-y)g(y)\dy}\dx \leq \int_{-\infty}^\infty  \int_{-\infty}^\infty \abs{f(x-y)}\abs{g(y)} \dy \dx$$
> מספיק שנראה שהאינטגרל האחרון הוא חסום ולא אינסוף. מצד שני, אם האינטגרל האחרון הוא סופי, זה אומר שהאינטגרל הראשון הוא סופי ובפרט $(f*g)(x)$ מוגדר וסופי כמעט לכל $x$.
> נשים לב שהאינטגרנד בצד ימין הוא על פונקציה אי שלילית ולכן ניתן להפעיל את פוביני ולקבל שהוא שווה ל  
> 
> $$.\int_{-\infty}^\infty  \abs{g(y)}\left(\int_{-\infty}^\infty \abs{f(x-y)} \dx\right) \dy\overset{t=x-y}{=}\int_{-\infty}^\infty  \abs{g(y)}\left(\int_{-\infty}^\infty \abs{f(t)} \dt\right) \dy = \norm{f}_1\norm{g}_1<\infty$$


> [!הערה]- הערה:
> 1. כדאי לשים לב שאינטגרל של פונקציה יכול להיות לא קיים לא רק בגלל אי התכנסות בגבולות $\pm \infty$  של האינטגרציה, אלא גם בגלל שהפונקציה עצמה לא אינטגרבילית. למשל, עבור אינטגרל רימן, פונקציית דיריכלה המוגדרת ע"י $D(x)=\cases{1 & x\in \QQ \\ 0 & else}$ היא כלל לא אינטגרבילית ללא קשר לגבולות האינטגרציה. דילגנו על החלק הזה בהוכחה, אבל באופן כללי זה גם משהו שצריך להראות.
> 2. בנוסף, חשוב לשים לב שמה שמראים למעלה זה ש $\abs{(f*g)(x)}$ מוגדרת וסופית **כמעט לכל $x$** ולא לכל $x$. למשל, נסתכל על הפונקציה $f(x)=\frac{1}{\sqrt{|x|+x^{10}}}$. זוהי פונקציה רציפה שאינטגרבילית בהחלט מאחר ועבור $x$-ים קטנים מתקיים ש $f(x)\sim \frac{1}{\sqrt{|x|}}$ שהאינטגרל שלה מתכנס ליד הראשית, ועבור $x$-ים גדולים מתקיים ש $f(x)\sim \frac{1}{\abs{x}^5}$ שהאינטגרל שלה מתכנס באינסוף. המשפט למעלה מראה שהקונבולוציה $(f*f)(x)$ קיימת כמעט לכל $x$, אבל אם נחשב את הקונבולוציה בראשית נקבל ש 
>    $$,(f*f)(0)=\int_{-\infty}^\infty f(-y)f(y)\dy=\int_{-\infty}^\infty f(y)^2\dy=\int_{-\infty}^\infty \frac{1}{|y|+y^{10}}\dy=\infty$$
>    וזה בגלל שעבור $y$-ים קטנים מתקיים ש $f(y)^2 \sim \frac{1}{|y|}$. לעומת זאת, לכל $x\neq 0$ הקבונולוציה $(f*f)(x)$ מוגדרת וסופית.
>    ניתן לראות את זה ב[תכנת דסמוס](https://www.desmos.com/calculator/subt8zphlu) למטה: בסגול רואים את הפונקציה $f(y)$ בשחור את $f(x_0-y)$ ובאדום את המכפלה שלהם שעליה רוצים לעשות אינטגרציה. שימו לב שניתן להזיז את הנקודה האדומה למטה וכך לשלוט על $x_0$. כל עוד $x_0\neq 0$ השטח יחסית קטן, ורק כאשר $x_0=0$ אז שני המקומות בהן $f(y),f(x_0-y)$ גדלים לאינסוף נופלים אחד על השני, ואז גם השטח הוא אינסופי.
>    <iframe src="https://www.desmos.com/calculator/subt8zphlu?embed" width="800" height="500" style="border: 1px solid #ccc" frameborder=0></iframe>

בשלב הזה אנחנו יודעים שעבור פונקציות במרחב $E^1(\RR)$ ניתן לחבר אותן ולכפול בסקלר (זה מרחב ווקטורי) ועכשיו גם אפשר לעשות בינהן קונבולוציה. כבר ראינו במקרה של פולינומים איך אפשר לכפל קונבולוציה מתוך מכפלה, ומסתבר שיש לה גם תכונות שאנחנו רגילים לשייך לכפל.

> [!טענה] תכונות אריתמטיות של קונבולוציה
> יהיו $f,g,h\in E^1(\RR)$, ו $\alpha \in \CC$ סקלר, אז:
> 1. אסוציאטיביות: $f*(g*h)=(f*g)*h$.
> 2. קומוטטיביות: $f*g=g*f$.
> 3. לינאריות (דיסטריביוטיביות + כפל בסקלר): $f*(\alpha g + h) = \alpha f*g + f*h$.
> 4. נגזרת: אם $f$ גזירה ואם $f*g$ קיימת וגזירה, אז $(f*g)'(x)=(f'*g)(x)$.

# התמרת פורייה של קונבולוציה

> [!משפט] משפט הקונבולוציה
> יהיו $f,g\in E^1(\RR)$, אז 
> $$.\widehat{f*g}(\omega) = 2\pi\hat {f}(\omega) \cdot \hat{g}(\omega)$$


> [!הוכחה] הוכחה:
> נשים לב תחילה שבגלל ש $f,g\in E^1(\RR)$ אז אנחנו יודעים ש $f*g$ אינטגרבילית בהחלט ולכן יש לה התמרת פורייה, ששווה ל:
> $$.\widehat{f*g}(\omega)= \frac{1}{2\pi} \int_{-\infty}^{\infty} (f*g)(x)e^{-i\omega x}\dx= \frac{1}{2\pi} \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} f(x-y)g(y)e^{-i\omega x}\dy\dx$$
> כבר ראינו שהאינטגרל הזה מתכנס בהחלט ולכן מותר לנו להחליף סדר אינטגרציה ולקבל את
> $$.\frac{1}{2\pi} \int_{-\infty}^{\infty} g(y) \int_{-\infty}^{\infty} f(x-y)e^{-i\omega x}\dx\dy\overset{x=t+y}{=}\frac{1}{2\pi} \int_{-\infty}^{\infty} g(y)e^{-i\omega y} \int_{-\infty}^{\infty} f(t)e^{-i\omega t}\dt\dy=2\pi \hat{f}(\omega) \hat{g}(\omega)$$


> [!דוגמא] דוגמא: הקונבולוציה של $e^{-x^2}*e^{-x^2}$.
> הרעיון פה הוא שבעוד קונבולוציה זו פעולה "מסובכת" לחשב, אם נבצע לה התמרה אז זה יהפוך לפשוט כפל פונקציות, ואז אפשר לעשות התמרה הפוכה כדי לחזור לפונקציה שרצינו לחשב, או במילים אחרות
> $$.(f*f)(x)=2\pi\cf\left[\cf[f*f]\right](-x)$$
> מבחינה פורמלית, נסמן ב $f(x)=e^{-x^2}$ נזכיר שראינו ש $\cf[f](\omega)=\frac{1}{2\sqrt{\pi}} e^{-\frac{\omega^2}{4}}$. שימוש במשפט הקונבולוציה יתן לנו ש
> $$.\cf[f*f](\omega)=2\pi\cf[f]^2(\omega)=\frac{1}{2} e^{-\frac{\omega^2}{2}}=\frac{1}{2}f(\frac{\omega}{\sqrt{2}})$$
> נחשב התמרה נוספת, תוך שימוש בתכונת ההתמרה של כפל המשתנה בסקלר ונקבל ש
> $$.2\pi\cf[\cf[f*f]](-x)=\pi \cf\left[f(\frac{\omega}{\sqrt{2}})\right](-x)=\sqrt{2}\pi \cf\left[f\right](-\sqrt{2}x)=\sqrt{\frac{\pi}{2}} e^{-\frac{x^2}{2}}$$

 

> [!דוגמא] דוגמא: חסימות בתדר
> אנחנו יודעים שבהינתן $f\in E^1(\RR)$ הלמה של רימן לבג אומרת ש $\hat{f}(\omega)\to 0$ כש $\abs{\omega} \to \infty$. כלומר, במובן מסויים רב ה"אנרגיה" של הפונקציה נמצאת בתדרים הנמוכים (כלומר $\abs{\omega}$ קטן). האם נוכל להפוך את הפונקציה ליותר "נקייה" במובן שנשתיק את התדרים המאוד גדולים? או בצורה יותר פורמלית, האם עבור $M>0$ קיימת פונקציה $f_M$ כך ש 
> $$? \;\;\;\widehat{f_M}(\omega)=\cases{\hat{f}(\omega) & |\omega|\leq M \\ 0 & |\omega|>M}$$
> נשים לב, שהדרישות על $\widehat{f_M}$ בעצם אומרות שההתמרה שלה צריכה להיות $\widehat{f_M}=\hat{f}\cdot \chi_{[-M,M]}$ ופה נוכל להעזר במשפט הקונבולוציה. 
> נזכיר ש $\cf[\chi_{[-M,M]}](\omega)=\frac{\sin(\omega M)}{\omega \pi}$, ואם נשתמש בהתמרה ההפוכה (עבור פונקציות ב $E^2$) נקבל ש $\cf[\frac{2\sin(xM)}{x}] = \chi_{[-M,M]}$ ולכן
> $$\cf\left[ (f*\frac{\sin(xM)}{\pi x})\right](\omega) = \cf\left[ f\right](\omega) \cdot \cf\left[ \frac{2\sin(xM)}{x}\right]= \cf\left[ f\right](\omega) \cdot \chi_{[-M,M]}(\omega)$$





